# EC2

![](images/img_37.png)

<br>

## 建立新實例

1. 點擊 `Launch Instance`。

    <img src="images/img_10.png" width="400px">

<br>

2. 任意命名，如 `MyWeb0903`，選取主機類行為 `Amazon Linux aws`，AMI 選取 `Amazon 2023 AMI`。

    <img src="images/img_07.png" width="400px">

<br>

3. 實例類型使用最基礎的設備規格 `t2.micro`。

    <img src="images/img_08.png" width="400px">

<br>

4. `Key pair` 可選取預設的 `vockey`，這是用來簡化學習過程中連接 EC2 實例的操作，並且與 AWS Academy 帳號相關聯；特別注意，預設的 key 無法下載 `.pem` 文件，之後可手動在本機生成，只是第一次寫入 EC2 主機時，必須使用 AWS 內建的終端機。。

    <img src="images/img_11.png" width="400px">

<br>

5. 或是點擊 `Create new key pair` 建立新的密鑰對。

    <img src="images/img_12.png" width="200px">

<br>

6. 任意命名如 `MyKey0903`，類型選擇預設的 `RSA` 或是更安全的 `ED25519` 皆可，然後點擊 `Create key pair`。

    <img src="images/img_13.png" width="400px">

<br>

7. 點擊後會自動下載 `.pem` 密鑰文件到本地。

    <img src="images/img_14.png" width="200px">

<br>

8. 其他關於 EC2 的設定都使用預設值，點擊右下角的 `Launch Instance` 建立實例。

    <img src="images/img_15.png" width="400px">

<br>

9. 回到清單中可見到新增的實例，此時正常狀況下的狀態是 `Running`。

    <img src="images/img_16.png" width="550px">

<br>

## 建立連線

1. 勾選實例後點擊 `Connect`。

    <img src="images/img_17.png" width="400px">

<br>

2. 會進入連線頁面，使用或切換到第一個頁籤 `EC2 Instance Connect`，並點擊右下角的 `Connect`，會啟動內建的終端機，預設使用這名稱為 `ec2-user`。

    <img src="images/img_18.png" width="400px">

<br>

3. 見到以下畫面代表連線成功。

    <img src="images/img_19.png" width="550px">

<br>

## 自訂連線

1. 可以參考頁籤 `SSH client` 中的說明建立連線。

    <img src="images/img_20.png" width="550px">

<br>

2. 若要使用下載的 Key 需依官方指示修改 `.pem` 文件權限，實質上是降低權限到 `400`；開啟終端機，輸入 `chmod 400` 之後將 `.pem` 文件拖曳到終端機中。

    <img src="images/img_21.png" width="500px">

<br>

3. 完成後透過  `ls -l` 指令查詢確實已經變更，`400` 就是 `唯讀`。

    <img src="images/img_22.png" width="=300px">

<br>

4. 紀錄 `Public IPv4 address` 備用。

    <img src="images/img_23.png" width="400px">

<br>

5. 接著在終端機中使用 `ssh` 指令進行連線。 

    ```bash
    ssh -i <.pem 文件完整路徑> ec2-user@34.201.150.132
    ```

<br>

6. 第一次連入時會詢問是否連線，確認後會將紀錄寫入本機的 `.ssh` 紀錄文件中。

    <img src="images/img_24.png" width="400px">

<br>

7. 完成連線。

    <img src="images/img_25.png" width="400px">

<br>

## 寫入本地密鑰到 EC2

1. 可以在本地建立密鑰並將公鑰複製到 EC2，運行以下指令後都按 `ENTER` 使用預設值即可。

    ```bash
    ssh-keygen
    ```

<br>

2. 在前面步驟的 EC2 內建終端機中編輯密鑰文件。

    ```bash
    cd .ssh && nano authorized_keys
    ```

<br>

3. 預設已寫入一則公鑰。

    ![](images/img_38.png)

<br>

4. 複製本機 `~/.ssh` 資料夾內的任意公鑰文件 `*.pub` 內容，具體選擇哪個公鑰取決於對加密方式的要求，以及相關設定的規劃。

    ![](images/img_39.png)

<br>

4. 貼到遠端的 `authorized_keys` 文件中，要貼在下一行，免換行符號；儲存 `control+O` 並退出 `control+X`。

    ![](images/img_40.png)

<br>

## 安裝相關套件

1. 參考官方的 [Amazon Linux 2023 Tutorial](https://docs.aws.amazon.com/linux/al2023/ug/ec2-lamp-amazon-linux-2023.html)。

<br>

2. 更新套件管理器並安裝 Apache。

    ```bash
    sudo dnf update -y && sudo dnf install -y httpd
    ```

<br>

3. 啟動並設置 Apache 在開機時啟動。

    ```bash
    sudo systemctl start httpd && sudo systemctl enable httpd
    ```

<br>

4. 查看 httpd 狀態。

    ```bash
    service httpd status
    ```

<br>

5. 若未啟動，則啟動服務並設定為開機啟動。

    ```bash
    sudo systemctl start httpd && sudo systemctl enable httpd
    ```

<br>

6. 若要檢查是否啟動。

    ```bash
    sudo systemctl is-enabled httpd
    ```

<br>

## 安裝 MariaDB

1. 安裝 MariaDB。

    ```bash
    sudo dnf install -y mariadb105-server
    ```

<br>

2. 啟動並設置 MariaDB 在開機時啟動。

    ```bash
    sudo systemctl start mariadb && sudo systemctl enable mariadb
    ```

<br>

3. 檢查 MariaDB 伺服器的運行狀態。

    ```bash
    sudo systemctl status mariadb
    ```

<br>

## 配置 MariaDB

1. 執行 MariaDB 安全設置腳本來配置 root 密碼和其他安全選項。

    ```bash
    sudo mysql_secure_installation
    ```

<br>

2. 設定與一般設定時相同，這裡暫時略過。

<br>

## 安裝 PHP


1. 安裝 PHP 及相關模組。

    ```bash
    sudo dnf install -y php php-mysqlnd
    ```

<br>

2. 重新啟動 Apache 以載入 PHP 模組。

    ```bash
    sudo systemctl restart httpd
    ```

<br>

## 建立網站

_建立簡單的 PHP 網頁_

<br>

1. 編輯文件。

    ```bash
    sudo nano /var/www/html/index.php
    ```

<br>

2. 寫入任意內容後儲存 `control+O`、退出 `control+X`。

    ```php
    <?php
    echo "Hello 你好，歡迎來到 AWS 課程測試首頁。";
    ?>
    ```

<br>

___

_END_


