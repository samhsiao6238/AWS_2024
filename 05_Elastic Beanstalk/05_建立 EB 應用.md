# 建立 EB 應用

_使用 EB CLI 建立 PHP Web 應用_

## 準備工作

1. 確認 EB CLI 已安裝。

```bash
eb --version
```

_輸出_

```bash
EB CLI 3.20.10 (Python 3.10.11 (v3.10.11:7d4cc5aa85, Apr  4 2023, 19:05:19) [Clang 13.0.0 (clang-1300.0.29.30)])
```

2. 建立並進入專案資料夾。

```bash
   cd ~/Desktop && mkdir _ex0714_ && cd _ex0714_
```

## 建立專案

1. 初始化 EB 應用。
```bash
eb init
```

2. 各項設定；特別說明，最後系統會將公鑰上傳至 EC2，並與指定區域`us-east-1` 中的實例關聯。
```bash
區域：us-east-1(1)
應用名稱，預設為資料夾名稱：_ex0714_(ENTER)
確認使用 PHP 平台：(Y)
選擇 PHP 版本：PHP 8.3 running on 64bit Amazon Linux 2023(1)
是否希望為實例設置 SSH 訪問：(Y)
命名 KeyPair，預設 aws-eb：(ENTER)
```

## 在專案建立 Git

1. 初始化 Git。

```bash
git init
```
2. 添加文件到 Git。

```bash
git add .
```
3. 提交文件到 Git。

```bash
git commit -m "Initial commit"
```
## 建立 PHP 文件

1. 編輯 PHP 文件 `index.php`。
```php
<?php
echo "Hello, Elastic Beanstalk!";
?>
```

## 創建 Elastic Beanstalk 環境

1. 建立環境。

```bash
eb create
```

2. Environment Name，按下 `ENTER` 使用預設值。

3. DNS CNAME prefix，使用預設值。

4. Load balancer type，選擇 `2 (application)`。

5. 是否啟用 Spot Fleet requests政策，選擇 `N`，僅使用按需實例。

6. 完成以上步驟會開始進行建立，需要等上一段時間。 
```bash
Creating application version archive "app-240714_184422381456".
Uploading _ex0714_/app-240714_184422381456.zip to S3. This may take a while.
Upload Complete.
Environment details for: eb--ex0714--dev
  Application name: _ex0714_
  Region: us-east-1
  Deployed Version: app-240714_184422381456
  Environment ID: e-yyd8qug2mm
  Platform: arn:aws:elasticbeanstalk:us-east-1::platform/PHP 8.3 running on 64bit Amazon Linux 2023/4.3.0
  Tier: WebServer-Standard-1.0
  CNAME: eb--ex0714--dev.us-east-1.elasticbeanstalk.com
  Updated: 2024-07-14 10:44:28.534000+00:00
Printing Status:
2024-07-14 10:44:27    INFO    createEnvironment is starting.
2024-07-14 10:44:28    INFO    Using elasticbeanstalk-us-east-1-730335644197 as Amazon S3 storage bucket for environment data.
2024-07-14 10:44:54    INFO    Created security group named: sg-06902153e6c305969
2024-07-14 10:44:54    INFO    Created security group named: awseb-e-yyd8qug2mm-stack-AWSEBSecurityGroup-v3lH1sI3PQC6
2024-07-14 10:44:54    INFO    Created Auto Scaling launch configuration named: awseb-e-yyd8qug2mm-stack-AWSEBAutoScalingLaunchConfiguration-9qUI8snszvj5
2024-07-14 10:45:10    INFO    Created target group named: arn:aws:elasticloadbalancing:us-east-1:730335644197:targetgroup/awseb-AWSEB-FPBPD40J1ATT/e633a004bf373d9b
2024-07-14 10:45:25    INFO    Created Auto Scaling group named: awseb-e-yyd8qug2mm-stack-AWSEBAutoScalingGroup-8RVXdVVS5ul6
2024-07-14 10:45:25    INFO    Waiting for EC2 instances to launch. This may take a few minutes.
2024-07-14 10:45:25    INFO    Created CloudWatch alarm named: awseb-e-yyd8qug2mm-stack-AWSEBCloudwatchAlarmLow-4YKY9hCpnDFS
2024-07-14 10:45:25    INFO    Created CloudWatch alarm named: awseb-e-yyd8qug2mm-stack-AWSEBCloudwatchAlarmHigh-Uj3v3v0eyldR
2024-07-14 10:45:25    INFO    Created Auto Scaling group policy named: arn:aws:autoscaling:us-east-1:730335644197:scalingPolicy:2b20ff82-124a-43b4-9156-fb19edaf0532:autoScalingGroupName/awseb-e-yyd8qug2mm-stack-AWSEBAutoScalingGroup-8RVXdVVS5ul6:policyName/awseb-e-yyd8qug2mm-stack-AWSEBAutoScalingScaleDownPolicy-m6HisIS9KT8Q
2024-07-14 10:45:25    INFO    Created Auto Scaling group policy named: arn:aws:autoscaling:us-east-1:730335644197:scalingPolicy:782b82e4-d073-4982-a2d2-12a4a7b4716a:autoScalingGroupName/awseb-e-yyd8qug2mm-stack-AWSEBAutoScalingGroup-8RVXdVVS5ul6:policyName/awseb-e-yyd8qug2mm-stack-AWSEBAutoScalingScaleUpPolicy-WHc4MN1JRlQz
2024-07-14 10:48:01    INFO    Created load balancer named: arn:aws:elasticloadbalancing:us-east-1:730335644197:loadbalancer/app/awseb--AWSEB-Azb8xEwzinUC/b6f103f50cb9da6d
2024-07-14 10:48:01    INFO    Created Load Balancer listener named: arn:aws:elasticloadbalancing:us-east-1:730335644197:listener/app/awseb--AWSEB-Azb8xEwzinUC/b6f103f50cb9da6d/e2fd7b3c6286bb45
2024-07-14 10:48:05    INFO    Instance deployment: You didn't include a 'composer.json' file in your source bundle. The deployment didn't install Composer dependencies.
2024-07-14 10:48:10    INFO    Instance deployment completed successfully.
2024-07-14 10:49:15    INFO    Successfully launched environment: eb--ex0714--dev
```

## Create 過程

_Elastic Beanstalk 環境已經成功創建並啟動_

1. 應用版本存檔並上傳到 S3。
2. 創建安全組、Auto Scaling 配置、目標組和 Auto Scaling 組。
3. 創建 CloudWatch 警報和擴展策略。
4. 創建負載均衡器和聽眾。
5. 部署應用實例，處理依賴項。
6. 環境成功創建並啟動。

#### 5. 部署應用
```bash
eb deploy
```

### 步驟說明

1. 政策安裝 EB CLI政策：
   - 使用 Homebrew 安裝 EB CLI 以便在終端使用。

2. 政策初始化應用 (`eb init`)政策：
   - 初始化 Elastic Beanstalk 應用並配置必要的設置。
   - 選擇離台灣最近的東京區域以獲得最佳性能。
   - 設定應用名稱並選擇 PHP 平台。
   - 配置 SSH 以便後續管理。

3. 政策創建 PHP 文件政策：
   - 在專案目錄中創建 `index.php`，內容為簡單的 PHP 代碼，顯示 "Hello, Elastic Beanstalk!"。

4. 政策創建環境 (`eb create`)政策：
   - 使用 `eb create` 創建 Elastic Beanstalk 環境。
   - 使用預設的環境名稱和 DNS CNAME 前綴，或根據需要自定義。
   - 選擇 Application Load Balancer 類型。
   - 不啟用 Spot Fleet requests。

5. 政策部署應用 (`eb deploy`)政策：
   - 使用 `eb deploy` 部署應用至 Elastic Beanstalk 環境。

這些步驟將幫助您在 AWS 上使用 Elastic Beanstalk 部署和管理 PHP Web 應用。通過這些指令，您可以快速建立和部署應用並確保其運行在最佳性能的環境中。