# LocalStack

_通過 Docker 容器模擬 AWS Lambda 服務_

<br>

## LocalStack

1. LocalStack 是一個本地 AWS 雲服務模擬器，可模擬多種 AWS 服務，包括 Lambda，可在本地開發和測試 AWS 服務。

<br>

## 安裝與運行 LocalStack

1. 安裝 Docker：確保已在樹莓派上安裝了 Docker。

<br>

2. 拉取 LocalStack Docker 映像。

    ```bash
    docker pull localstack/localstack
    ```

<br>

3. 運行 LocalStack。

    ```bash
    docker run -d -p 4566:4566 -p 4571:4571 localstack/localstack
    ```

4. 確保可使用 `awslocal`，需要安裝以下幾個模組；`awscli-local` 用於與本地的模擬 AWS 服務的工具 LocalStack 互動；`awscli` 是 Amazon 提供的命令行工具，用於與 AWS 服務互動；`localstack-client` 是 LocalStack 提供的 Python 客戶端庫。

    ```bash
    pip install awscli-local awscli localstack-client
    ```

<br>

## 創建和部署 Lambda 函數

1. 建立並進入專案資料夾。

    ```bash
    cd ~/Documents && mkdir exAWS && cd exAWS
    ```

2. 在工作目錄下創建一個名為 `lambda_function.py` 的文件。

    ```bash
    touch lambda_function.py
    ```

3. 編輯專案腳本。

    ```python
    def lambda_handler(event, context):
        return {
            'statusCode': 200,
            'body': 'Hello from Lambda!'
        }
    ```

3. 壓縮 Lambda 函數代碼：使用 `zip` 命令將 `lambda_function.py` 文件壓縮成一個 `function.zip` 文件。

    ```bash
    zip function.zip lambda_function.py
    ```

4. 運行 LocalStack：確保 LocalStack 容器已經在運行，使用以下命令檢查。

    ```bash
    docker ps
    ```

5. 使用 `awslocal` 命令創建和部署 Lambda 函數：在包含 `function.zip` 文件的目錄中運行以下命令來創建 Lambda 函數。

    ```bash
    awslocal lambda create-function --function-name my-function --runtime python3.10 --role arn:aws:iam::000000000000:role/lambda-role --handler lambda_function.lambda_handler --zip-file fileb://function.zip
    ```

6. 測試 Lambda 函數：使用 `awslocal` 來測試 Lambda 函數。

    ```bash
    awslocal lambda invoke --function-name my-function output.txt
    cat output.txt
    ```

<br>

## AWS SAM CLI

1. AWS Serverless Application Model (SAM) CLI 是一個開源框架，允許開發人員在本地開發、測試和部署無伺服器應用程式。

<br>

## 安裝與運行 AWS SAM CLI

1. 安裝 Docker：確保已在樹莓派上安裝了 Docker。

<br>

2. 安裝 SAM CLI：參考官方文件在樹莓派上安裝 AWS SAM CLI。

<br>

3. 初始化 SAM 專案。

    ```bash
    sam init
    ```

<br>

4. 運行本地 Lambda：在初始化的專案目錄中運行以下命令以本地測試 Lambda 函數。

    ```bash
    sam local invoke
    ```

<br>

___

_END_

