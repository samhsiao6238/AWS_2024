# Task 12：測試完整解決方案

此任務的目的是測試已完成的 POC（概念驗證）解決方案，確保其能夠正常運行，並驗證其處理 2 月份數據的功能。

---

## 測試最新的工作流程結果

1. 進入 Step Functions 主控台，使用與之前相同的方法運行 WorkflowPOC 狀態機。

2. 將測試名稱設為 `TaskTwelveTest`，然後開始執行。

3. 完成的工作流程如下圖所示：

   ![Completed workflow for the POC](images/task12_workflow.png)

4. 提示： 在 Graph inspector 區段中，可以拖曳位於頁面底部的橫條來調整圖表大小，以便更清晰地查看工作流程圖。

---

## 驗證迭代器是否正常工作

1. 在 Graph Inspector 區段中，選擇 `CheckTable` 步驟。

2. 頁面頂部會出現兩個下拉選單，分別為 Iteration status 和 Index。預設情況下，第一個迭代（索引值為 0）被選中。

3. 在右側的 Details 面板中，確認該次迭代已成功完成。

4. 將 Index 更改為 1，並確認該次迭代也已成功完成。

5. 重複上述步驟，確認索引值為 2、3 和 4 的迭代均已成功。

6. 將 Index 值切換回 0，並選擇 Step input 頁籤。

7. 確認顯示的 JSON 代碼是否如下圖所示，其中 `VarCharValue` 的值應設為 `nyctaxi_lookup_csv`。

    ![Step input tab in Graph inspector section](images/task12_input.png)

8. 保持在 Step input 頁籤，變更索引值，直到 `VarCharValue` 的值變為 `yellowtaxi_data_parquet`。

9. 在圖表中，選擇 `Insert New Parquet Data` 步驟，然後切換到 Step output 頁籤。

10. 在此處可以查看創建檢視表的查詢以及其他步驟的執行細節。

---

## 在 Athena 控制台中進行測試

1. 進入 Athena 主控台，打開查詢編輯器，並確保資料庫選擇為 `nyctaxidb`。

2. 在 Views 區段中，選擇 `yellowtaxi_data_vw` 檢視表右側的三點圖標，然後選擇 Preview View。

3. 預覽結果的前 10 條記錄應顯示出來，並確認檢視表現在掃描包含 2 月數據的數據集。

4. 為驗證 2 月的計程車數據已包含在數據集中，執行以下查詢：

    ```sql
    SELECT * FROM "nyctaxidb"."yellowtaxi_data_vw" WHERE pickup_month = '02'
    ```

5. 結果應顯示前 100 條記錄，如下圖所示，確認 2 月份數據已成功納入查詢結果：

    ![February data included in query results](images/task12_february_data.png)

---

## 總結

在此任務中，成功測試了 ETL 工作流程。該工作流程現在可以處理新增的 2 月份數據，並將其整合至檢視表中，以便通過 Athena 查詢。

---

## 團隊更新

在完成完整的 POC 後，向 Mary 進行了快速演示，並獲得了她的肯定。Mary 表示她有信心可以複製此 POC，並根據每個項目需求調整內部的硬編碼值。她已經迫不及待想使用這個 ETL 工作流程來加速她的數據處理項目。