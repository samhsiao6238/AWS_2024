# 流水筆記


##

1. 預設是全部關閉的

![](images/img_01.png)

2. 添加紀錄。

```bash
Bucket_name=mybuctket1025
My_region=us-east-1
```


3. 建立

```bash
aws s3api create-bucket --bucket $Bucket_name --region $My_region
```

4. 禁用 S3 Bucket 的公共存取限制
```bash
aws s3api put-public-access-block --bucket $Bucket_name --public-access-block-configuration BlockPublicAcls=false,IgnorePublicAcls=false,BlockPublicPolicy=false,RestrictPublicBuckets=false
```

![](images/img_02.png)

5. 允許所有人訪問該 Bucket 中的所有對象；特別注意，這樣設定後，所有上傳的文件都是公開的。

```bash
policy=$(cat << EOF
{
    "Version": "2012-10-17",
    "Statement": [
        {
        "Effect": "Allow",
        "Principal": "*",
        "Action": "s3:GetObject",
        "Resource": "arn:aws:s3:::$Bucket_name/*"
        }
    ]
}
EOF
)

echo "$policy" | envsubst | aws s3api put-bucket-policy --bucket $Bucket_name --policy file://<(echo "$policy" | envsubst)
```

![](images/img_03.png)

6. 查詢當前 Buckets。

```bash
aws s3api list-buckets --query "Buckets[].Name"
```

7. 查詢指令 bucket
```bash
aws s3api get-bucket-acl --bucket $Bucket_name
```

8. 查詢 Bucket 的區域；特別注意，如果 Bucket 是在 `us-east-1` 中建立的，當查詢它的地理位置時，返回值會是 null

```bash
aws s3api get-bucket-location --bucket $Bucket_name
```

9. 查詢 Bucket 的公共訪問設定

```bash
aws s3api get-public-access-block --bucket $Bucket_name
```

10. 查詢 Bucket 的政策

```bash
aws s3api get-bucket-policy --bucket $Bucket_name
```

11. 列出特定 Bucket 內的物件

```bash
aws s3 ls s3://$Bucket_name --recursive
```

##

_當前路徑中準備一張圖片 `monkey.jpeg`_




1. 設定環境參數，圖片路徑

```bask
Image_path=monkey.jpeg
```

2. 上傳圖片到 S3 Bucket
```bash
aws s3 cp $Image_path s3://$Bucket_name/
```

3. 獲取該物件的詳細資訊


```bash
aws s3api head-object --bucket $Bucket_name --key $Image_path
```

4. 禁用 Block Public ACL 設置

```bash
aws s3api put-public-access-block --bucket $Bucket_name --public-access-block-configuration BlockPublicAcls=false

```

5. 更新 Bucket Policy

```bash
aws s3api put-bucket-policy --bucket $Bucket_name --policy '{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Principal": "*",
      "Action": "s3:GetObject",
      "Resource": "arn:aws:s3:::'$Bucket_name'/*"
    }
  ]
}'
```

6. 檢查 Policy

```bash
aws s3api get-bucket-policy --bucket $Bucket_name
```

7. 訪問物件

```bash
open -a "Google Chrome" https://$Bucket_name.s3.amazonaws.com/monkey.jpeg
```

