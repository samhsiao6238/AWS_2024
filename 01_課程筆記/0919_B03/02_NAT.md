## NAT



私有網必須透過 `NAT Gateway` 去外網


**NAT** (Network Address Translation) 是一種在網路中用來修改封包 IP 位址的技術。它的主要目的是在內部私有網路與外部公有網路之間進行 IP 位址轉換，從而達到節省公有 IP 位址和提高網路安全性的目的。以下是詳細的解釋：

### 1. **NAT 的基本功能**
   NAT 可以讓一個內部私有網路中的多台設備共用一個或少數幾個公有 IP 位址進行外部通信。當內部的設備發送資料到外部網路時，NAT 會將這些設備的私有 IP 位址轉換成公有 IP 位址，並且在收到外部網路的回應時，再把公有 IP 位址轉換回私有 IP 位址，使得內部設備能夠正確接收資料。

### 2. **NAT 的工作方式**
   - 當一個內部設備 (使用私有 IP) 試圖訪問外部網路時，NAT 會記錄這個內部 IP 位址和它發送的連線請求（通常是包括源 IP 位址、目標 IP 位址和埠號的三元組）。
   - 然後 NAT 會將內部的私有 IP 位址替換為路由器的公有 IP 位址，並將封包發送到外部網路。
   - 當外部網路的回應到達 NAT 路由器時，NAT 會根據之前記錄的映射表將封包中的公有 IP 位址替換回對應的內部私有 IP 位址，並將封包傳送回內部設備。

### 3. **NAT 的類型**
   NAT 可以分為以下幾種類型：

   - **靜態 NAT (Static NAT)**: 
     - 將一個內部私有 IP 位址靜態地映射到一個公有 IP 位址。這通常用於內部設備需要從外部訪問，例如一個內部的伺服器。
     
   - **動態 NAT (Dynamic NAT)**: 
     - 將內部的私有 IP 位址動態地映射到一組預定義的公有 IP 位址。這意味著每個內部設備可能會被映射到不同的公有 IP，具體取決於當時的可用性。
     
   - **PAT (Port Address Translation)**: 
     - 這是 NAT 的一種擴展，通常也被稱為 **NAT Overloading**。它允許多個內部設備共用一個公有 IP 位址，但通過不同的埠號來區分每個連線。PAT 是現代網路中最常見的 NAT 形式，特別是在家庭路由器中。當多個內部設備使用同一個公有 IP 位址時，PAT 會根據每個連線的埠號來區分。

### 4. **NAT 的優點**
   - **節省公有 IP 位址**: 由於公有 IP 位址是一種有限資源，NAT 通過讓多台內部設備共用一個或少量的公有 IP 位址，能有效減少公有 IP 位址的需求。
   
   - **隱藏內部網路結構**: NAT 隱藏了內部私有網路的架構和 IP 位址，這在一定程度上增加了網路的安全性，因為外部網路無法直接訪問內部設備。
   
   - **提供有限的安全性**: 雖然 NAT 本身不是防火牆，但由於外部網路無法直接發起對內部設備的連線，它可以防止一些未經授權的訪問。

### 5. **NAT 的缺點**
   - **連接跟蹤限制**: NAT 需要對每個連線進行記錄（即建立 NAT 映射表），這可能會造成路由器資源的消耗。
   
   - **對某些應用的兼容性問題**: 某些需要直接建立端到端連線的應用（如 P2P、VoIP 等），在使用 NAT 時可能會遇到問題，因為 NAT 改變了源 IP 位址，影響了應用程序的連線建立。

### 總結：
NAT 是一種在私有網路與公有網路之間進行 IP 位址轉換的技術，主要功能是讓多台內部設備共享一個或少量的公有 IP 位址進行外部通信，並且提高網路的安全性。常見的 NAT 類型包括靜態 NAT、動態 NAT 和 PAT（Port Address Translation）。